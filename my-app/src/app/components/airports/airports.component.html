
<p-overlayPanel #op [dismissable]="true" [showCloseIcon]="true">
    <ng-template pTemplate>
        Executes a full text search, once enter-key is pressed.
        <br/>
        <p-divider>
            <div class="p-d-inline-flex p-ai-center">
                <b>Filtering</b>
            </div><%@page import="com.birnbaua.model.Airport"%>
          <%@page import="java.util.List"%>
          <%@ page language="java" contentType="text/html; charset=ISO-8859-1"
          pageEncoding="ISO-8859-1"%>
          <!DOCTYPE html>
          <html>
          <head>
            <meta charset="UTF-8"/>
            <meta name="viewport" content="width=device-width, initial-scale=1">
            <meta name="author" content="Luke, I am your father">
            <title>Airports</title>
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
            <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
            <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
            <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
          </head>
          <body>
          <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
              <ul class="navbar-nav mr-auto">
                <li class="nav-item">
                  <a class="nav-link" href="/jsp_assignment/hotels">Hotels</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/jsp_assignment/airports">Airports</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/jsp_assignment/vehicles">Vehicles</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/jsp_assignment/routes">Routes</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/jsp_assignment/drivers">Drivers</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/jsp_assignment/rides">Rides</a>
                </li>
              </ul>
            </div>

          </nav>
          <div class="container div-center">
            <table id=hotels class="table">
              <colgroup>
                <col span="1" style="width: 10%;">
                <col span="1" style="width: 25%;">
                <col span="1" style="width: 50%;">
                <col span="1" style="width: 15%;">
              </colgroup>
              <thead>
              <tr>
                <th>Icao Code</th>
                <th>Name</th>
                <th>Description</th>
                <th></th>
              </tr>
              </thead>
              <%
              List<Airport> airports = (List<Airport>) request.getAttribute("airports");
              for(Airport airport : airports) {
              %>
              <tr>
                <td><%=airport.getIcaoCode()%></td>
                <td><%=airport.getName()%></td>
                <td><%=airport.getDesc()%></td>
                <td>
                  <form action="airports" method="post">
                    <input hidden="true" name="delete" value="<%=airport.getIcaoCode()%>"></input>
                    <input type="submit" value="DELETE">
                  </form>
                </td>
              </tr>
              <%
              }
              %>
            </table>
          </div>
          <div class="container" role="toolbar" id="lettersToolbar">
            <div class="btn-group mr-2" style="padding-bottom: 20px">
              <button class="btn btn-default" data-toggle="modal" data-target="#myModal" style="background-color: #337ab7" id="add">Add new Airport</button>
            </div>
          </div>
          <!-- class modal fade not working?? -->
          <div id="myModal" class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog">
              <!-- Modal content-->
              <div class="modal-content">
                <div class="modal-header">
                  <h4 class="modal-title">Create new Airport</h4>
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                  <form id="hotelForm" method="post" action="/jsp_assignment/airports">
                    <div class="form-group">
                      <label for="name1">ICAO Code</label>
                      <input type="text" class="form-control" id="icaoCode1" name="icaoCode" required>
                    </div>
                    <div class="form-group">
                      <label for="name1">Name</label>
                      <input type="text" class="form-control" id="name1" name="name" required>
                    </div>
                    <div class="form-group">
                      <label for="url1">Description</label>
                      <input type="text" class="form-control" id="desc1" name="desc">
                    </div>
                    <input type="submit" class="btn btn-primary" value="Save"></input>
                  </form>
                </div>
                <div class="modal-footer">
                  <button id="closeModal" type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div>
          </body>
          </html>
        </p-divider>
        For filtering use key-value pairs followed by a semicolon:<br/>
        e.g. <b>key:value;</b><br/>
        key = filter element; value = value you want to search for<br/>
        Eligible key values:
        <ul>
            <li>name</li>
            <li>description</li>
            <li>tag</li>
            <li>updatedFrom (e.g. updatedFrom: 01.01.2021;)</li>
            <li>updatedTo (e.g. updatedTo: 01.01.2021;)</li>
            <li>path</li>
            <li>response</li>
            <li>parameter</li>
        </ul>
        <small class="text-muted">Exemplary search: name:myapi;description:this is my description;path:/pet;</small>
    </ng-template>
</p-overlayPanel>

<p-table #dt [value]="data" styleClass="p-datatable-striped" [autoLayout]="false"
    selectionMode="single" [(selection)]="selectedApi" dataKey="name"
    (onRowSelect)="onRowSelect($event)" (onRowUnselect)="onRowUnselect($event)"
    [lazy]="true" (onLazyLoad)="loadCustomers($event)"
    [rows]="10" [showCurrentPageReport]="true" [rowsPerPageOptions]="[10,25,50]" [totalRecords]="distinctCount"
    [paginator]="true" currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
    [loading]="loading">

    <ng-template pTemplate="caption">
        <div class="d-flex justify-content-center">
            <span class="p-input-icon-left p-ml-auto">
                <i class="pi pi-search"></i>
                <input style="width: 500px;" pInputText type="text"
                    (input)="onInputCheckEmpty($event.target.value)" (keyup.enter)="onSearchInput($event.target.value)"
                    (focus)="op.toggle($event)" placeholder="Search keyword" />
            </span>
        </div>
    </ng-template>
    <ng-template pTemplate="header">
        <tr>
            <th style="width: 3rem"></th>
            <th [ngStyle]="{'width': '15%'}">Name</th>
            <th [ngStyle]="{'width': '15%'}">Namespace</th>
            <th [ngStyle]="{'width': '15%'}">Version</th>
            <th>Description</th>
            <th [ngStyle]="{'width': '10%'}">Status</th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-rowData let-expanded="expanded">
        <tr [pSelectableRow]="rowData">
            <td>
                <button type="button" pButton pRipple [pRowToggler]="rowData"
                    class="p-button-text p-button-rounded p-button-plain"
                    [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></button>
            </td>
            <td>{{rowData.name}}</td>
            <td>{{rowData.namespace}}</td>
            <td>{{rowData.version}}</td>
            <td>{{rowData.description}}</td>
            <td>{{rowData.status}}</td>
        </tr>
    </ng-template>
    <ng-template pTemplate="rowexpansion" let-rowData>

        <tr>
			<td colspan="6">
				<div class="d-flex flex-row align-items-center">

                    <b>Versions</b>
                    <div class="p-1" *ngFor="let version of rowData.allVersions| keyvalue">
                        <button class="p-tag p-tag-rounded p-1 border-0" (click)="onVersionSelect(version.value)"
                            >{{version.key}}</button>
                    </div>
                    <button class="p-tag p-tag-rounded p-1 border-0" (click)="showDialogNewVersion(rowData)"> + </button>
                </div>

                <div class="d-flex" *ngIf="rowData.foundLines != undefined && rowData.foundLines.length != 0">
                    <p>Search matches with following lines:</p><br/>
                    <ul>
                        <li *ngFor="let i of rowData.foundLines">
                            {{i}}
                        </li>
                    </ul>
                </div>
			</td>
		</tr>
    </ng-template>
</p-table>

<app-upload-dialog [(display)]="displayUploadDialog" (displayChange)="onDialogClose($event)" [apiModel]="apiModelToAdd"></app-upload-dialog>

<a class="float">
    <button pButton (click)="showDialog()" label="Upload API" icon="pi pi-plus"></button>
</a>
